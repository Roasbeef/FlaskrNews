// Generated by CoffeeScript 1.4.0
(function() {

  (function($) {
    var $container, $register, displayMessage;
    $register = $('a#register');
    $container = $('.form-container');
    displayMessage = function(type, message) {
      var input_box, show_message,
        _this = this;
      input_box = this.closest('.control-group');
      show_message = function() {
        return $('.help-inline', _this.parent()).text(message);
      };
      if (type === 'success') {
        input_box.removeClass('error').addClass('success');
        show_message();
        return $('button').removeClass('disabled').closest('form').off();
      } else {
        input_box.removeClass('success').addClass('error');
        show_message();
        return $('button').addClass('disabled').closest('form').on('click', function(e) {
          return false;
        });
      }
    };
    return $register.on('click', function(e) {
      e.preventDefault();
      return $.get('/register', function(result) {
        return $container.html(result);
      }).then(function() {
        var $confirm, $user_input;
        $user_input = $('input#inputUsername');
        $confirm = $('input#inputConfirm');
        $('<span class="help-inline"></span>').appendTo('.controls');
        $user_input.on('blur', function() {
          var _this = this;
          if (!$.trim($(this).val())) {
            displayMessage.call($(this), 'error', 'Username required!');
            return;
          }
          return $.getJSON('/_check_username', {
            username: $user_input.val()
          }, function(data) {
            if (data.result === "all good") {
              return displayMessage.call($(_this), 'success', 'Username is available!');
            } else {
              return displayMessage.call($(_this), 'error', 'Username is taken!');
            }
          });
        });
        return $confirm.on('blur', function() {
          var $pass;
          $pass = $('input#inputPassword');
          if ($(this).val() !== $pass.val()) {
            displayMessage.call($(this), 'error', 'Passwords must match!');
            return displayMessage.call($pass, 'error', '');
          } else {
            displayMessage.call($(this), 'success', '');
            return displayMessage.call($pass, 'success', '');
          }
        });
      });
    });
  })(jQuery);

}).call(this);
