// Generated by CoffeeScript 1.4.0
(function() {

  (function($) {
    var $edit_button, $reply_button, reply_form;
    $reply_button = $('button.reply');
    $edit_button = $('button.edit');
    reply_form = '<form id="change"><textarea rows="1" cols="1" name="comment_text" style="display: block; margin-left: 4%; margin-top: 10px;"></textarea><button class="btn btn-mini save" type="button" style="margin-left: 4%; margin-right: 1%;">Save</button><button class="btn btn-mini cancel" type="button">Cancel</button></form>';
    $reply_button.on('click', function(e) {
      var $cancel_button, $comment_text, $container, $save_button;
      $container = $(this).parent();
      if (!$container.find('form#change').length) {
        $container.append(reply_form).find('button.save').addClass('disabled');
      }
      $comment_text = $container.find('form textarea');
      $save_button = $comment_text.next();
      $cancel_button = $save_button.next();
      $comment_text.on('keyup blur', function(e) {
        var $self;
        console.log('k');
        $self = $(this);
        if ($self.val()) {
          return $self.next().removeClass('disabled');
        } else {
          return $self.next().addClass('disabled');
        }
      });
      $cancel_button.on('click', function(e) {
        console.log('k');
        return $(this).parent().remove();
      });
      return $save_button.on('click', function(e) {
        var $self, comment_id, post_id, reply_url;
        e.preventDefault();
        $self = $(this);
        comment_id = $self.parent().siblings('div.c_votes').find('a i').eq(0).data('id');
        post_id = $('div.link div.votes').find('a i').data('id');
        reply_url = "/post/" + post_id + "/" + comment_id + "/reply";
        return $.post(reply_url, {
          comment: $comment_text.val()
        }).done(function() {
          return $.get("/comment/_newest", {
            post: post_id,
            author: "x"
          }, function(data) {
            return console.log(data);
          });
        });
      });
    });
    return $edit_button.on('click', function(e) {
      var $cancel_button, $comment_body, $container, $edit_form, $save_button, $self, comment_text;
      $self = $(this);
      $container = $self.parent();
      $comment_body = $container.find('p.c_body');
      comment_text = $.trim($comment_body.text());
      if (!$container.find('form#change').length) {
        $comment_body.detach();
        $container.find('span.comment_info').after(reply_form);
      }
      $edit_form = $container.find('form textarea').first();
      $cancel_button = $container.find('button.cancel');
      $save_button = $container.find('button.save');
      if (comment_text) {
        $edit_form.val(comment_text);
      }
      $cancel_button.on('click', function(e) {
        $self = $(this);
        return $self.parent().prev().after($comment_body).end().remove();
      });
      return $save_button.on('click', function(e) {
        var comment_id, new_comment;
        e.preventDefault();
        $self = $(this);
        new_comment = $edit_form.val();
        comment_id = $self.parent().siblings('div.c_votes').find('a i').eq(0).data('id');
        return $.post("/comment/" + comment_id + "/edit", {
          new_comment: new_comment
        }).done(function(data) {
          return $self.parent().prev().after($comment_body.text(new_comment).hide().fadeIn('slow')).end().remove();
        });
      });
    });
  })(jQuery);

}).call(this);
